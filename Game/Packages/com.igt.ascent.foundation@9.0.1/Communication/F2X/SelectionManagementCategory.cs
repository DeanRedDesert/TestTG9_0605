//-----------------------------------------------------------------------
// <copyright file = "SelectionManagementCategory.cs" company = "IGT">
//     Copyright (c) 2020 IGT.  All rights reserved.
// </copyright>
//-----------------------------------------------------------------------
// <auto-generated>
//     This code was generated by C3G.
//
//     Changes to this file may cause incorrect behavior
//     and will be lost if the code is regenerated.
// </auto-generated>
//-----------------------------------------------------------------------

namespace IGT.Game.Core.Communication.Foundation.F2X
{
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using F2XTransport;
    using Schemas.Internal.SelectionManagement;
    using Schemas.Internal.Types;

    /// <summary>
    /// Implementation of the F2X <see cref="SelectionManagement"/> category.
    /// Selection Management category of messages.
    /// Category: 2002; Major Version: 1
    /// </summary>
    public class SelectionManagementCategory : F2XTransactionalCategoryBase<SelectionManagement>, ISelectionManagementCategory
    {
        #region Fields

        /// <summary>
        /// Object which implements the SelectionManagementCategory callbacks.
        /// </summary>
        private readonly ISelectionManagementCategoryCallbacks callbackHandler;

        #endregion

        #region Constructor

        /// <summary>
        /// Instantiates a new <see cref="SelectionManagementCategory"/>.
        /// </summary>
        /// <param name="transport">
        /// Transport that this category will be installed in.
        /// </param>
        /// <param name="callbackHandler">
        /// SelectionManagementCategory callback handler.
        /// </param>
        /// <exception cref="ArgumentNullException">
        /// Thrown if the <paramref name="callbackHandler"/> is null.
        /// </exception>
        public SelectionManagementCategory(IF2XTransport transport, ISelectionManagementCategoryCallbacks callbackHandler)
            : base(transport)
        {
            this.callbackHandler = callbackHandler ?? throw new ArgumentNullException(nameof(callbackHandler));
            AddMessagehandler<AppRequestedSend>(HandleAppRequested);
            AddMessagehandler<AppStateChangedSend>(HandleAppStateChanged);
            AddMessagehandler<AvailableAppsChangedSend>(HandleAvailableAppsChanged);
            AddMessagehandler<ChooserRequestedSend>(HandleChooserRequested);
            AddMessagehandler<DisplayStateChangedSend>(HandleDisplayStateChanged);
        }

        #endregion

        #region IApiCategory Members

        /// <inheritdoc/>
        public override MessageCategory Category => MessageCategory.SelectionManagement;

        /// <inheritdoc/>
        public override uint MajorVersion => 1;

        /// <inheritdoc/>
        public override uint MinorVersion => 0;

        #endregion

        #region ISelectionManagementCategory Members

        /// <inheritdoc/>
        public bool DisplayShell(ShellIdentifier shell, uint denom, DisplayState displayState)
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<DisplayShellSend>();
            var content = (DisplayShellSend)request.Message.Item;
            content.Shell = shell;
            content.Denom = denom;
            content.DisplayState = displayState;

            var reply = SendMessageAndGetReply<DisplayShellReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
            return reply.Content.Displayed;
        }

        /// <inheritdoc/>
        public bool DisplayTheme(ThemeIdentifier theme, uint denom, DisplayState displayState)
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<DisplayThemeSend>();
            var content = (DisplayThemeSend)request.Message.Item;
            content.Theme = theme;
            content.Denom = denom;
            content.DisplayState = displayState;

            var reply = SendMessageAndGetReply<DisplayThemeReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
            return reply.Content.Displayed;
        }

        /// <inheritdoc/>
        public AppState GetAppState()
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<GetAppStateSend>();

            var reply = SendMessageAndGetReply<GetAppStateReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
            return reply.Content.State;
        }

        /// <inheritdoc/>
        public GetAvailableAppsReplyContent GetAvailableApps()
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<GetAvailableAppsSend>();

            var reply = SendMessageAndGetReply<GetAvailableAppsReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
            return reply.Content;
        }

        /// <inheritdoc/>
        public GetDefaultAppReplyContent GetDefaultApp()
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<GetDefaultAppSend>();

            var reply = SendMessageAndGetReply<GetDefaultAppReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
            return reply.Content;
        }

        /// <inheritdoc/>
        public IEnumerable<GameProperties> GetGameProperties(IEnumerable<ThemeIdentifier> theme, IEnumerable<string> section)
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<GetGamePropertiesSend>();
            var content = (GetGamePropertiesSend)request.Message.Item;
            content.Theme = theme.ToList();
            content.Section = section.ToList();

            var reply = SendMessageAndGetReply<GetGamePropertiesReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
            return reply.Content;
        }

        /// <inheritdoc/>
        public GetSelectedAppReplyContent GetSelectedApp()
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<GetSelectedAppSend>();

            var reply = SendMessageAndGetReply<GetSelectedAppReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
            return reply.Content;
        }

        /// <inheritdoc/>
        public IEnumerable<ThemePerformanceMeters> GetThemePerformanceMeters(IEnumerable<ThemeIdentifier> theme, int periodInWeeks)
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<GetThemePerformanceMetersSend>();
            var content = (GetThemePerformanceMetersSend)request.Message.Item;
            content.Theme = theme.ToList();
            content.PeriodInWeeks = periodInWeeks;

            var reply = SendMessageAndGetReply<GetThemePerformanceMetersReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
            return reply.Content;
        }

        /// <inheritdoc/>
        public void SetChooserOfferable(bool offerable)
        {
            Transport.MustHaveHeavyweightTransaction();
            var request = CreateTransactionalRequest<SetChooserOfferableSend>();
            var content = (SetChooserOfferableSend)request.Message.Item;
            content.Offerable = offerable;

            var reply = SendMessageAndGetReply<SetChooserOfferableReply>(Channel.Foundation, request);
            CheckReply(reply.Exception);
        }

        #endregion

        #region Message Handlers

        /// <summary>
        /// Handler for the AppRequestedSend message.
        /// </summary>
        /// <param name="message">
        /// Message from the Foundation to handle.
        /// </param>
        private void HandleAppRequested(AppRequestedSend message)
        {
            var errorMessage = callbackHandler.ProcessAppRequested(message.Theme, message.Shell, message.Denom, message.Required);
            var errorCode = string.IsNullOrEmpty(errorMessage) ? 0 : 1;
            var replyMessage = CreateReply<AppRequestedReply>(errorCode, errorMessage);
            SendFoundationChannelResponse(replyMessage);
        }

        /// <summary>
        /// Handler for the AppStateChangedSend message.
        /// </summary>
        /// <param name="message">
        /// Message from the Foundation to handle.
        /// </param>
        private void HandleAppStateChanged(AppStateChangedSend message)
        {
            var errorMessage = callbackHandler.ProcessAppStateChanged(message.State);
            var errorCode = string.IsNullOrEmpty(errorMessage) ? 0 : 1;
            var replyMessage = CreateReply<AppStateChangedReply>(errorCode, errorMessage);
            SendFoundationChannelResponse(replyMessage);
        }

        /// <summary>
        /// Handler for the AvailableAppsChangedSend message.
        /// </summary>
        /// <param name="message">
        /// Message from the Foundation to handle.
        /// </param>
        private void HandleAvailableAppsChanged(AvailableAppsChangedSend message)
        {
            var errorMessage = callbackHandler.ProcessAvailableAppsChanged(message.Themes, message.Shells, message.CoThemes);
            var errorCode = string.IsNullOrEmpty(errorMessage) ? 0 : 1;
            var replyMessage = CreateReply<AvailableAppsChangedReply>(errorCode, errorMessage);
            SendFoundationChannelResponse(replyMessage);
        }

        /// <summary>
        /// Handler for the ChooserRequestedSend message.
        /// </summary>
        /// <param name="message">
        /// Message from the Foundation to handle.
        /// </param>
        private void HandleChooserRequested(ChooserRequestedSend message)
        {
            var errorMessage = callbackHandler.ProcessChooserRequested();
            var errorCode = string.IsNullOrEmpty(errorMessage) ? 0 : 1;
            var replyMessage = CreateReply<ChooserRequestedReply>(errorCode, errorMessage);
            SendFoundationChannelResponse(replyMessage);
        }

        /// <summary>
        /// Handler for the DisplayStateChangedSend message.
        /// </summary>
        /// <param name="message">
        /// Message from the Foundation to handle.
        /// </param>
        private void HandleDisplayStateChanged(DisplayStateChangedSend message)
        {
            var errorMessage = callbackHandler.ProcessDisplayStateChanged(message.DisplayState);
            var errorCode = string.IsNullOrEmpty(errorMessage) ? 0 : 1;
            var replyMessage = CreateReply<DisplayStateChangedReply>(errorCode, errorMessage);
            SendFoundationChannelResponse(replyMessage);
        }

        #endregion

    }

}

